More functions with nested loops